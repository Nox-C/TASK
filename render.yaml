services:
  - type: web
    name: task
    plan: free
    region: oregon
    runtime: node
    rootDir: ./
    
    buildCommand: corepack enable && pnpm install --frozen-lockfile && pnpm build --filter @task/web
    startCommand: cd apps/web && pnpm start
    healthCheckPath: /api/health
    
    envVars:
      - key: NODE_VERSION
        value: "20.x"
      - key: NODE_ENV
        value: "production"
      - key: NPM_CONFIG_PRODUCTION
        value: "false"
      - key: NEXT_PUBLIC_ENVIRONMENT
        value: production
        
      # Fix: Removed 'sync: false' from variables where you provide a value
      - key: NEXT_PUBLIC_API_URL
        sync: false # You will enter this manually in Render Dashboard
      - key: NEXT_PUBLIC_WS_URL
        value: "wss://stream.binance.com:9443/ws" # Hardcoded for Binance
      - key: NEXT_PUBLIC_WS_ENDPOINT
        value: "wss://stream.binance.com:9443/ws" # Hardcoded for Binance

  - type: worker
    name: task-worker
    plan: free
    region: oregon
    runtime: node
    rootDir: ./
    
    buildCommand: corepack enable && pnpm install --frozen-lockfile && pnpm build --filter @task/worker
    startCommand: cd apps/worker && pnpm start
    
    envVars:
      - key: NODE_VERSION
        value: "20.x"
      - key: NODE_ENV
        value: "production"
      - key: NEXT_PUBLIC_ENVIRONMENT
        value: production
